<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CINEMA DATABASE // SERIES</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cinema-red: #e50914;
            --cinema-dark: #141414;
            --text-light: #f5f5f1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--cinema-dark);
            color: var(--text-light);
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.8), var(--cinema-dark));
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 4rem;
            padding-top: 2rem;
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 5rem;
            color: var(--cinema-red);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(229, 9, 20, 0.4);
        }

        button {
            background: var(--cinema-red);
            color: white;
            border: none;
            padding: 10px 25px;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
            border-radius: 4px;
        }

        button:hover {
            background: white;
            color: var(--cinema-red);
        }

        .return-btn {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 200;
            background: rgba(0,0,0,0.5);
            border: 1px solid white;
        }

        .empty-state {
            text-align: center;
            margin-top: 50px;
            padding: 60px;
            background: #1f1f1f;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .empty-state h2 {
            font-family: 'Bebas Neue';
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #fff;
        }

        /* Reproductor */
        .bard-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border-top: 2px solid var(--cinema-red);
            padding: 15px;
            width: 300px;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            text-align: center;
            color: white;
        }
        .bard-title {
            color: var(--cinema-red);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        /* Visualizador */
        .visualizer {
            display: none;
            justify-content: center;
            align-items: flex-end;
            height: 40px;
            gap: 4px;
            margin-top: 15px;
        }
        .bar {
            width: 5px;
            background-color: var(--cinema-red);
            animation: dance 1s infinite ease-in-out;
        }
        @keyframes dance {
            0%, 100% { height: 10%; }
            50% { height: 100%; }
        }

        /* --- RELOJES Y PERFILES (ESTILO CINE) --- */
        .clock-panel {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            border-left: 2px solid var(--cinema-red);
            padding: 1.5rem;
            z-index: 10;
            text-align: right;
            margin-top: -30px;
        }
        .clock-item { margin-bottom: 1rem; }
        .clock-item:last-child { margin-bottom: 0; }
        .clock-label { color: #999; font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 2px; }
        .clock-time { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: #fff; }

        .profile-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }
        .profile-card {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #333;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            width: 280px;
            cursor: pointer;
            transition: 0.3s;
        }
        .profile-card:hover { border-color: var(--cinema-red); }
        .profile-avatar {
            width: 50px; height: 50px;
            background-color: #333;
            background-size: cover;
            background-position: center;
            border: 1px solid var(--cinema-red);
        }
        .profile-details { flex-grow: 1; }
        .profile-name { font-family: 'Bebas Neue'; font-size: 1.2rem; color: #fff; }
        .profile-level { font-size: 0.8rem; color: #999; }
        .profile-edit-btn {
            background: transparent !important;
            border: none !important;
            color: #666 !important;
            padding: 0 !important;
            font-size: 1.2rem;
        }
        .profile-edit-btn:hover { color: var(--cinema-red) !important; }

        /* Editor Modal */
        .config-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #141414; border: 2px solid var(--cinema-red); padding: 2rem;
            z-index: 2000; width: 320px; display: none; box-shadow: 0 0 50px rgba(229, 9, 20, 0.2);
        }
        .config-item { margin-bottom: 1rem; }
        .config-item label { display: block; color: #999; font-size: 0.8rem; margin-bottom: 5px; }
        .config-item input { width: 100%; background: #333; border: 1px solid #555; color: white; padding: 8px; font-family: 'Montserrat', sans-serif; }

        /* --- CINE ANTIGUO OVERLAY --- */
        #cinema-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505; z-index: 9999;
            display: none; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .film-grain {
            position: absolute; top: -5%; left: -5%; width: 110%; height: 110%;
            opacity: 0.15; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            animation: grain 0.2s steps(3) infinite;
        }
        @keyframes grain { 0% { transform: translate(0,0); } 100% { transform: translate(-5%,-5%); } }
        
        .countdown-circle {
            width: 300px; height: 300px;
            border: 4px solid #333; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            position: relative;
            box-shadow: 0 0 50px rgba(255,255,255,0.1);
        }
        .countdown-circle::before, .countdown-circle::after {
            content: ''; position: absolute; background: #333;
        }
        .countdown-circle::before { width: 100%; height: 2px; top: 50%; }
        .countdown-circle::after { height: 100%; width: 2px; left: 50%; }
        
        #countdown-number {
            font-family: 'Bebas Neue'; font-size: 10rem; color: #e5e5e5;
            z-index: 2; text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        
        #cinema-screen {
            width: 95%; height: 90%;
            background: #000;
            box-shadow: 0 0 100px rgba(255,255,255,0.1);
            display: none; z-index: 10;
        }
        
        .close-cinema-btn {
            position: absolute; top: 20px; right: 20px;
            background: transparent; color: #555; border: none; font-size: 2rem;
            cursor: pointer; z-index: 20;
        }
        .close-cinema-btn:hover { color: var(--cinema-red); }

        /* NUEVOS ESTILOS PARA EL BUSCADOR Y GRID */
        .input-group {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 40px;
        }
        .cinema-input {
            background: #1a1a1a; border: 2px solid #333; color: white;
            padding: 12px 20px; font-family: 'Montserrat'; width: 100%; max-width: 400px;
            border-radius: 50px; font-size: 1rem; transition: 0.3s;
        }
        .cinema-input:focus { border-color: var(--cinema-red); outline: none; box-shadow: 0 0 15px rgba(229, 9, 20, 0.3); }
        
        .series-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 30px; margin-top: 20px;
        }
        .series-card {
            background: #1a1a1a; border-radius: 10px; overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s; position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); border: 1px solid #333;
        }
        .series-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.8); border-color: var(--cinema-red); z-index: 5; }
        .series-poster { width: 100%; height: auto; display: block; }
        .series-card.favorite {
            border: 2px solid #ffd700; /* Borde Dorado */
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.3);
        }
        .series-card.finished .series-poster {
            filter: grayscale(100%);
            opacity: 0.5;
        }
        .series-info { padding: 15px; }
        .series-title { font-family: 'Bebas Neue'; font-size: 1.4rem; margin-bottom: 5px; line-height: 1; color: #fff; }
        .series-meta { font-size: 0.8rem; color: #888; display: flex; justify-content: space-between; text-transform: uppercase; font-weight: bold; }
        .series-type { color: var(--cinema-red); }
        
        .delete-btn {
            position: absolute; top: 10px; right: 10px;
            background: rgba(0,0,0,0.8); color: white; border: none;
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.2s;
        }
        .series-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background: var(--cinema-red); }

        .fav-btn {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.8); color: #555; border: none;
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.2s; font-size: 1.2rem; padding: 0;
        }
        .series-card:hover .fav-btn { opacity: 1; }
        .fav-btn:hover { color: #ffd700; transform: scale(1.1); }
        .fav-btn.active { color: #ffd700; opacity: 1; }
        
        .finish-btn {
            position: absolute; top: 10px; left: 50px;
            background: rgba(0,0,0,0.8); color: #555; border: none;
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.2s; font-size: 1.2rem; padding: 0;
        }
        .series-card:hover .finish-btn { opacity: 1; }
        .finish-btn:hover { color: #4ade80; transform: scale(1.1); }
        .finish-btn.active { color: #4ade80; opacity: 1; }

        .config-btn {
            position: fixed; top: 30px; left: 30px; z-index: 200;
            background: rgba(0,0,0,0.8); border: 1px solid #555; color: #aaa;
            padding: 8px 15px; cursor: pointer; font-family: 'Montserrat'; font-size: 0.8rem;
        }
        .config-btn:hover { color: white; border-color: white; }

        /* PROGRESS BAR STYLES */
        .progress-container { margin-top: 10px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 4px; }
        .progress-text { font-size: 0.7rem; color: #aaa; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .progress-bar-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-bottom: 5px; }
        .progress-bar-fill { height: 100%; background: var(--cinema-red); transition: width 0.3s; }
        .progress-controls { display: flex; gap: 5px; }
        .progress-controls button { flex: 1; padding: 2px 0; font-size: 0.8rem; background: #222; border: 1px solid #444; border-radius: 2px; }
        .progress-controls button:hover { background: var(--cinema-red); color: white; border-color: var(--cinema-red); }

        .filter-btn {
            background: transparent; border: 1px solid #555; color: #aaa;
            padding: 8px 20px; font-size: 0.8rem; margin-bottom: 20px;
            cursor: pointer; transition: 0.3s; border-radius: 20px;
        }
        .filter-btn:hover { border-color: white; color: white; }
        .filter-btn.active { border-color: #4ade80; color: #4ade80; background: rgba(74, 222, 128, 0.1); }
    </style>
</head>
<body>

    <button class="return-btn" onclick="window.location.href='hub.html'">‚Ü© VOLVER AL HUB</button>

    <!-- Profile Editor Modal (Necesario para que funcione el script) -->
    <div id="profileEditor" class="config-panel">
        <h3 style="margin-bottom: 1rem; color: var(--cinema-red); font-family: 'Bebas Neue'; font-size: 1.5rem;">EDITAR PERFIL</h3>
        <div class="config-item"><label>PLATAFORMA</label><input type="text" id="edit-platform" placeholder="STEAM / NETFLIX"></div>
        <div class="config-item"><label>USUARIO</label><input type="text" id="edit-name" placeholder="Tu Nick"></div>
        <div class="config-item"><label>NIVEL / ESTADO</label><input type="text" id="edit-level" placeholder="Viendo..."></div>
        <div class="config-item"><label>URL AVATAR</label><input type="text" id="edit-avatar" placeholder="https://..."></div>
        <div class="config-item"><label>URL PERFIL</label><input type="text" id="edit-url" placeholder="Link al perfil"></div>
        <div style="display: flex; gap: 10px;">
            <button onclick="saveProfile()" style="flex: 1;">GUARDAR</button>
            <button onclick="closeProfileEditor()" style="flex: 1; background: #333; color: #aaa;">CANCELAR</button>
        </div>
    </div>

    <!-- Perfiles -->
    <div class="profile-container">
        <div class="profile-card" onclick="visitProfile(1)">
            <div class="profile-avatar" id="p1-avatar"></div>
            <div class="profile-details"><div class="profile-name" id="p1-name">LINK ACCOUNT 01</div><div class="profile-level" id="p1-level">OFFLINE</div></div>
            <button class="profile-edit-btn" onclick="event.stopPropagation(); openProfileEditor(1)">‚öôÔ∏è</button>
        </div>
        <div class="profile-card" onclick="visitProfile(2)">
            <div class="profile-avatar" id="p2-avatar"></div>
            <div class="profile-details"><div class="profile-name" id="p2-name">LINK ACCOUNT 02</div><div class="profile-level" id="p2-level">OFFLINE</div></div>
            <button class="profile-edit-btn" onclick="event.stopPropagation(); openProfileEditor(2)">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Cinema Database</h1>
            <p style="color: #999; letter-spacing: 1px;">COLECCI√ìN DE SERIES Y PEL√çCULAS</p>
            <p id="finished-counter" style="color: #4ade80; font-weight: bold; margin-top: 10px; font-size: 1.1rem; text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);">COMPLETADAS: 0</p>
        </header>

        <div class="input-group">
            <input type="text" id="seriesInput" class="cinema-input" placeholder="Escribe el nombre (Ej: Breaking Bad)..." onkeypress="handleEnter(event)">
            <button onclick="addSeries()">A√ëADIR</button>
        </div>

        <div style="text-align: center;">
            <button id="filterBtn" class="filter-btn" onclick="toggleHideFinished()">üëÅÔ∏è MOSTRAR TODO</button>
        </div>

        <div id="seriesList" class="series-grid"></div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <h2>LA SALA EST√Å VAC√çA</h2>
            <p style="color: #aaa;">No hay proyecciones programadas por el momento.</p>
        </div>
    </div>

    <!-- Relojes -->
    <div class="clock-panel">
        <div class="clock-item"><div class="clock-label">üá™üá∏ ESPA√ëA</div><div class="clock-time" id="clock-esp">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üá∏üá¥ SOMALIA</div><div class="clock-time" id="clock-som">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üá∫üá∏ USA (NY)</div><div class="clock-time" id="clock-usa">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üá∏üá¶ ARABIA</div><div class="clock-time" id="clock-sa">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üá≤üá¶ MARRUECOS</div><div class="clock-time" id="clock-ma">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üáªüá≥ VIETNAM</div><div class="clock-time" id="clock-vn">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üáßüá© BANGLADESH</div><div class="clock-time" id="clock-bd">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üá∞üá™ KENYA</div><div class="clock-time" id="clock-ke">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">üáÆüá≥ INDIA</div><div class="clock-time" id="clock-in">00:00:00</div></div>
        <div class="clock-item"><div class="clock-label">‚úàÔ∏è üè¢üè¢</div><div class="clock-time" id="clock-meme">00:00:00</div></div>
    </div>

    <!-- PLAYER -->
    <div class="bard-player">
        <div class="bard-title">üçø AMBIENTE DE CINE</div>
        <div id="bard-controls">
            <button onclick="summonBard()" style="width: 100%; padding: 8px; font-size: 0.8rem;">‚ñ∂ REPRODUCIR BSO</button>
            <button onclick="openCinema()" style="width: 100%; padding: 8px; font-size: 0.8rem; margin-top: 5px; background: #222; border: 1px solid #444;">üé• PROYECTAR (URL)</button>
        </div>
        
        <div id="visualizer" class="visualizer">
            <div class="bar" style="animation-duration: 0.9s;"></div>
            <div class="bar" style="animation-duration: 1.3s;"></div>
            <div class="bar" style="animation-duration: 0.8s;"></div>
            <div class="bar" style="animation-duration: 1.2s;"></div>
            <div class="bar" style="animation-duration: 1.0s;"></div>
        </div>

        <div id="bard-frame" style="width:0;height:0;overflow:hidden;"></div>
    </div>

    <!-- CINEMA OVERLAY -->
    <div id="cinema-overlay">
        <div class="film-grain"></div>
        <button class="close-cinema-btn" onclick="closeCinema()">√ó</button>
        <div id="countdown-container" class="countdown-circle">
            <div id="countdown-number">10</div>
        </div>
        <div id="cinema-screen"></div>
    </div>

    <script>
        let cinemaTimer = null;

        function summonBard() {
            const frame = document.getElementById('bard-frame');
            frame.innerHTML = '<iframe width="1" height="1" src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&loop=1&playlist=jfKfPfyJRdk" title="Lofi Movie" frameborder="0" allow="autoplay" allowfullscreen></iframe>';
            document.getElementById('bard-controls').style.display = 'none';
            document.getElementById('visualizer').style.display = 'flex';
        }

        function openCinema() {
            let url = prompt("üéûÔ∏è PEGA LA URL DEL V√çDEO (YouTube):");
            if (!url) return;

            // Convertir URL de YouTube a Embed
            if (url.includes("watch?v=")) {
                url = url.replace("watch?v=", "embed/");
                if (url.includes("&")) url = url.split("&")[0];
            } else if (url.includes("youtu.be/")) {
                url = url.replace("youtu.be/", "www.youtube.com/embed/");
            }

            const overlay = document.getElementById('cinema-overlay');
            const countEl = document.getElementById('countdown-number');
            const countCont = document.getElementById('countdown-container');
            const screen = document.getElementById('cinema-screen');
            const grain = document.querySelector('.film-grain');

            // Resetear estado inicial (luces tenues y grano activado)
            overlay.style.background = "#050505";
            grain.style.display = "block";

            overlay.style.display = 'flex';
            countCont.style.display = 'flex';
            screen.style.display = 'none';
            screen.innerHTML = '';

            let count = 10;
            countEl.innerText = count;

            if (cinemaTimer) clearInterval(cinemaTimer);
            cinemaTimer = setInterval(() => {
                count--;
                if (count > 0) {
                    countEl.innerText = count;
                } else {
                    clearInterval(cinemaTimer);
                    countCont.style.display = 'none';
                    
                    // APAGAR LUCES: Fondo negro puro y quitar ruido visual
                    overlay.style.background = "#000000";
                    grain.style.display = "none";

                    screen.style.display = 'block';
                    screen.innerHTML = `<iframe width="100%" height="100%" src="${url}?autoplay=1&modestbranding=1&rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                }
            }, 1000);
        }

        function closeCinema() {
            if (cinemaTimer) clearInterval(cinemaTimer);
            const overlay = document.getElementById('cinema-overlay');
            const screen = document.getElementById('cinema-screen');
            overlay.style.display = 'none';
            screen.innerHTML = ''; // Parar v√≠deo
            
            // Restaurar ambiente al salir
            overlay.style.background = "#050505";
            document.querySelector('.film-grain').style.display = "block";
        }

        // --- L√ìGICA DE BASE DE DATOS DE SERIES ---
        let seriesDB = JSON.parse(localStorage.getItem('platinumSeries')) || [];
        let hideFinished = false;

        function toggleHideFinished() {
            hideFinished = !hideFinished;
            const btn = document.getElementById('filterBtn');
            if (hideFinished) {
                btn.innerText = "üôà OCULTANDO TERMINADAS";
                btn.classList.add('active');
            } else {
                btn.innerText = "üëÅÔ∏è MOSTRAR TODO";
                btn.classList.remove('active');
            }
            renderSeries();
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addSeries();
        }

        function addSeries() {
            const input = document.getElementById('seriesInput');
            const name = input.value.trim();

            if (!name) return;

            // 1. Pedir Tipo
            let typeInput = prompt(`¬øQU√â ES "${name}"?\n\nEscribe "S" para SERIE o "P" para PEL√çCULA:`, "S");
            if (typeInput === null) return;
            let type = (typeInput.toUpperCase().includes("S") || typeInput.toUpperCase().includes("SERIE")) ? "SERIES" : "MOVIE";

            // 2. Pedir Poster
            let posterUrl = prompt(`üé¨ P√ìSTER PARA "${name}"\n\nPega el enlace de la imagen:`, "");
            if (!posterUrl) posterUrl = "https://via.placeholder.com/300x450?text=NO+IMAGE";

            // 3. Pedir Duraci√≥n
            let runtime = prompt(`‚è±Ô∏è DURACI√ìN (Ej: "24 min" o "2h 30m"):`, "?? min");
            if (!runtime) runtime = "?? min";

            const newItem = {
                id: Date.now(),
                title: name,
                poster: posterUrl,
                runtime: runtime,
                type: type,
                year: new Date().getFullYear().toString(),
                totalSeasons: "1",
                customDuration: null,
                totalEpisodes: 0,
                currentEpisode: 0,
                isFavorite: false, // Nuevo campo
                isFinished: false
            };

            // L√≥gica extra para Series
            if (type === "SERIES") {
                let seasons = prompt("¬øCU√ÅNTAS TEMPORADAS TIENE?", "1");
                newItem.totalSeasons = seasons || "1";

                let episodes = prompt(`üî¢ ¬øCU√ÅNTOS CAP√çTULOS TIENE EN TOTAL?\n(Necesario para la barra de progreso):`, "12");
                if (episodes && !isNaN(episodes)) {
                    newItem.totalEpisodes = parseInt(episodes);
                    
                    // Intentar calcular tiempo total si el runtime empieza por n√∫mero
                    let minutes = parseInt(runtime);
                    if (!isNaN(minutes)) {
                        const totalMins = minutes * parseInt(episodes);
                        const hours = Math.floor(totalMins / 60);
                        const mins = totalMins % 60;
                        newItem.customDuration = `${hours}h ${mins}m`;
                    }
                }
            }

            seriesDB.unshift(newItem);
            localStorage.setItem('platinumSeries', JSON.stringify(seriesDB));
            renderSeries();
            input.value = '';
        }

        function deleteSeries(id) {
            if(confirm('¬øEliminar de la colecci√≥n?')) {
                seriesDB = seriesDB.filter(item => item.id !== id);
                localStorage.setItem('platinumSeries', JSON.stringify(seriesDB));
                renderSeries();
            }
        }

        function renderSeries() {
            const list = document.getElementById('seriesList');
            const empty = document.getElementById('emptyState');
            list.innerHTML = '';

            // Actualizar contador de completadas
            const finishedCount = seriesDB.filter(i => i.isFinished).length;
            const counterEl = document.getElementById('finished-counter');
            if(counterEl) counterEl.innerText = `COMPLETADAS: ${finishedCount}`;

            // Filtrar lista si est√° activo el modo ocultar
            let displayList = seriesDB;
            if (hideFinished) {
                displayList = seriesDB.filter(item => !item.isFinished);
            }

            if (displayList.length === 0) {
                empty.style.display = 'block';
                const p = empty.querySelector('p');
                if (seriesDB.length > 0 && hideFinished) {
                    p.innerText = "No hay series pendientes. ¬°Todo visto!";
                } else {
                    p.innerText = "No hay proyecciones programadas por el momento.";
                }
            } else {
                empty.style.display = 'none';
                displayList.forEach(item => {
                    // L√≥gica para mostrar duraci√≥n total estimada o temporadas
                    let durationDisplay = item.runtime;
                    
                    // Si hemos calculado el tiempo total, mostramos eso (PRIORIDAD)
                    if (item.customDuration) {
                        durationDisplay = item.customDuration + " (TOTAL)";
                    } else if (item.type === 'SERIES' && item.totalSeasons && item.totalSeasons !== "N/A") {
                        // Si no, mostramos las temporadas como antes
                        durationDisplay = `${item.totalSeasons} TEMPS`;
                        if (item.runtime && item.runtime !== "N/A") durationDisplay += ` (${item.runtime})`;
                    }

                    // HTML de la barra de progreso (Solo si tiene episodios definidos)
                    let progressHtml = '';
                    if (item.totalEpisodes > 0) {
                        const currentEp = item.currentEpisode || 0;
                        const pct = (currentEp / item.totalEpisodes) * 100;
                        progressHtml = `
                            <div class="progress-container">
                                <div class="progress-text"><span>CAP√çTULO</span> <span>${currentEp} / ${item.totalEpisodes}</span></div>
                                <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: ${pct}%"></div></div>
                                <div class="progress-controls">
                                    <button onclick="updateProgress(${item.id}, -1)">-</button>
                                    <button onclick="updateProgress(${item.id}, 1)">+</button>
                                </div>
                            </div>
                        `;
                    }

                    const card = document.createElement('div');
                    card.className = `series-card ${item.isFavorite ? 'favorite' : ''} ${item.isFinished ? 'finished' : ''}`;
                    card.innerHTML = `
                        <img src="${item.poster}" class="series-poster" alt="${item.title}">
                        <div class="series-info">
                            <div class="series-title">${item.title}</div>
                            <div class="series-meta">
                                <span>‚è±Ô∏è ${durationDisplay}</span>
                                <span class="series-type">${item.type}</span>
                            </div>
                            ${progressHtml}
                        </div>
                        <button class="fav-btn ${item.isFavorite ? 'active' : ''}" onclick="toggleFavorite(${item.id})">‚òÖ</button>
                        <button class="finish-btn ${item.isFinished ? 'active' : ''}" onclick="toggleFinished(${item.id})" title="Marcar como terminada">‚úì</button>
                        <button class="delete-btn" onclick="deleteSeries(${item.id})">√ó</button>
                    `;
                    list.appendChild(card);
                });
            }
        }

        // --- SONIDO DE FAVORITO (Web Audio API) ---
        function playFavoriteSound() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            // Sonido tipo "campana" o "moneda" agudo
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, ctx.currentTime); // Empieza agudo
            osc.frequency.exponentialRampToValueAtTime(1800, ctx.currentTime + 0.1); // Sube r√°pido

            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5); // Se apaga suave

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }

        function toggleFavorite(id) {
            const item = seriesDB.find(i => i.id === id);
            if (item) {
                item.isFavorite = !item.isFavorite;
                if (item.isFavorite) playFavoriteSound(); // ¬°DING!
                localStorage.setItem('platinumSeries', JSON.stringify(seriesDB));
                renderSeries();
            }
        }

        function toggleFinished(id) {
            const item = seriesDB.find(i => i.id === id);
            if (item) {
                item.isFinished = !item.isFinished;
                localStorage.setItem('platinumSeries', JSON.stringify(seriesDB));
                renderSeries();
            }
        }

        function updateProgress(id, change) {
            const item = seriesDB.find(i => i.id === id);
            if (item && item.totalEpisodes > 0) {
                let newEp = (item.currentEpisode || 0) + change;
                if (newEp < 0) newEp = 0;
                if (newEp > item.totalEpisodes) newEp = item.totalEpisodes;
                item.currentEpisode = newEp;
                localStorage.setItem('platinumSeries', JSON.stringify(seriesDB));
                renderSeries();
            }
        }

        // Cargar al inicio
        document.addEventListener('DOMContentLoaded', renderSeries);
    </script>

    <script src="script.js"></script>
</body>
</html>